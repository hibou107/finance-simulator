package com.hibou107.finance

import com.hibou107.finance.InternalRateOfReturn.CashFlow

object DollarAveragingSimulator {
  val data = """1971-02-01	636.31
            |1971-03-01	663.8
            |1971-04-01	701.65
            |1971-05-01	672.99
            |1971-06-01	665.23
            |1971-07-01	648.04
            |1971-08-01	665.81
            |1971-09-01	669.55
            |1971-10-01	643.84
            |1971-11-01	636.92
            |1971-12-01	695.68
            |1972-01-01	724.63
            |1972-02-01	760.56
            |1972-03-01	775.5
            |1972-04-01	792.84
            |1972-05-01	798.23
            |1972-06-01	781.52
            |1972-07-01	763.95
            |1972-08-01	775.15
            |1972-09-01	771.31
            |1972-10-01	771.41
            |1972-11-01	785.66
            |1972-12-01	788.34
            |1973-01-01	755.12
            |1973-02-01	703.19
            |1973-03-01	679.62
            |1973-04-01	619.71
            |1973-05-01	585.77
            |1973-06-01	572.35
            |1973-07-01	614.47
            |1973-08-01	582.55
            |1973-09-01	616.38
            |1973-10-01	605.27
            |1973-11-01	510.47
            |1973-12-01	499.95
            |1974-01-01	510.44
            |1974-02-01	500.81
            |1974-03-01	483.68
            |1974-04-01	453.41
            |1974-05-01	413.43
            |1974-06-01	388.38
            |1974-07-01	354.99
            |1974-08-01	312.54
            |1974-09-01	275.68
            |1974-10-01	319.82
            |1974-11-01	306.25
            |1974-12-01	288.75
            |1975-01-01	335.57
            |1975-02-01	348.36
            |1975-03-01	359.69
            |1975-04-01	371.97
            |1975-05-01	391.4
            |1975-06-01	406.73
            |1975-07-01	384.59
            |1975-08-01	364.55
            |1975-09-01	341.1
            |1975-10-01	351.38
            |1975-11-01	357.04
            |1975-12-01	350.38
            |1976-01-01	392.25
            |1976-02-01	405.27
            |1976-03-01	406.16
            |1976-04-01	402.3
            |1976-05-01	390.37
            |1976-06-01	398.4
            |1976-07-01	400.58
            |1976-08-01	391.54
            |1976-09-01	396.98
            |1976-10-01	390.94
            |1976-11-01	393.64
            |1976-12-01	421.37
            |1977-01-01	409.2
            |1977-02-01	400.88
            |1977-03-01	396.38
            |1977-04-01	398.72
            |1977-05-01	397.18
            |1977-06-01	411.69
            |1977-07-01	413.37
            |1977-08-01	409.81
            |1977-09-01	411.57
            |1977-10-01	396.61
            |1977-11-01	417.55
            |1977-12-01	423.88
            |1978-01-01	404.27
            |1978-02-01	404.16
            |1978-03-01	419.7
            |1978-04-01	451.62
            |1978-05-01	467.01
            |1978-06-01	462.31
            |1978-07-01	481.66
            |1978-08-01	512.5
            |1978-09-01	500.73
            |1978-10-01	414.92
            |1978-11-01	426.3
            |1978-12-01	436.64
            |1979-01-01	461.51
            |1979-02-01	444.4
            |1979-03-01	472.89
            |1979-04-01	474.93
            |1979-05-01	460.5
            |1979-06-01	478.62
            |1979-07-01	484.34
            |1979-08-01	510.74
            |1979-09-01	503.78
            |1979-10-01	451.59
            |1979-11-01	476.2
            |1979-12-01	493.77
            |1980-01-01	520.84
            |1980-02-01	501.75
            |1980-03-01	409.77
            |1980-04-01	432.99
            |1980-05-01	460.83
            |1980-06-01	478.07
            |1980-07-01	520.58
            |1980-08-01	546.01
            |1980-09-01	560.09
            |1980-10-01	569.66
            |1980-11-01	609.88
            |1980-12-01	587.39
            |1981-01-01	569.69
            |1981-02-01	564.33
            |1981-03-01	595.02
            |1981-04-01	609.47
            |1981-05-01	623.48
            |1981-06-01	596.55
            |1981-07-01	578.81
            |1981-08-01	531.27
            |1981-09-01	483.92
            |1981-10-01	523.83
            |1981-11-01	538.46
            |1981-12-01	521.91
            |1982-01-01	500.55
            |1982-02-01	475.13
            |1982-03-01	465.65
            |1982-04-01	487.61
            |1982-05-01	466.88
            |1982-06-01	442.47
            |1982-07-01	430.09
            |1982-08-01	455.65
            |1982-09-01	480.2
            |1982-10-01	542.42
            |1982-11-01	594.02
            |1982-12-01	596.6
            |1983-01-01	636.27
            |1983-02-01	667.05
            |1983-03-01	692.98
            |1983-04-01	744.67
            |1983-05-01	779.85
            |1983-06-01	802.49
            |1983-07-01	762.33
            |1983-08-01	731.05
            |1983-09-01	738.07
            |1983-10-01	681.16
            |1983-11-01	707.32
            |1983-12-01	688.98
            |1984-01-01	660.07
            |1984-02-01	618.04
            |1984-03-01	612.4
            |1984-04-01	601.28
            |1984-05-01	564.12
            |1984-06-01	578.99
            |1984-07-01	552.89
            |1984-08-01	610.63
            |1984-09-01	596.36
            |1984-10-01	587.61
            |1984-11-01	576.67
            |1984-12-01	587.85
            |1985-01-01	661.91
            |1985-02-01	671.85
            |1985-03-01	657.52
            |1985-04-01	657.73
            |1985-05-01	679.02
            |1985-06-01	689.55
            |1985-07-01	700.22
            |1985-08-01	690.66
            |1985-09-01	648.33
            |1985-10-01	674.21
            |1985-11-01	721.89
            |1985-12-01	744.67
            |1986-01-01	767.64
            |1986-02-01	823.97
            |1986-03-01	862.93
            |1986-04-01	884.04
            |1986-05-01	920.86
            |1986-06-01	927.78
            |1986-07-01	849.76
            |1986-08-01	874.54
            |1986-09-01	797.49
            |1986-10-01	819.38
            |1986-11-01	815.93
            |1986-12-01	790.73
            |1987-01-01	883.4
            |1987-02-01	954.13
            |1987-03-01	961.27
            |1987-04-01	928.77
            |1987-05-01	922.55
            |1987-06-01	937.31
            |1987-07-01	957.65
            |1987-08-01	996.45
            |1987-09-01	968.13
            |1987-10-01	702.53
            |1987-11-01	662.59
            |1987-12-01	717.52
            |1988-01-01	746.28
            |1988-02-01	792.72
            |1988-03-01	805.76
            |1988-04-01	811.49
            |1988-05-01	789.48
            |1988-06-01	837.95
            |1988-07-01	818.75
            |1988-08-01	792.74
            |1988-09-01	810.68
            |1988-10-01	797.13
            |1988-11-01	773.83
            |1988-12-01	792.93
            |1989-01-01	830.29
            |1989-02-01	823.38
            |1989-03-01	833.33
            |1989-04-01	870.17
            |1989-05-01	903.11
            |1989-06-01	878.87
            |1989-07-01	913.95
            |1989-08-01	943.76
            |1989-09-01	947.69
            |1989-10-01	908.92
            |1989-11-01	907.64
            |1989-12-01	903.69
            |1990-01-01	817.88
            |1990-02-01	833.29
            |1990-03-01	847.92
            |1990-04-01	816.67
            |1990-05-01	890
            |1990-06-01	891.78
            |1990-07-01	841.78
            |1990-08-01	725.8
            |1990-09-01	650.42
            |1990-10-01	619.03
            |1990-11-01	672.59
            |1990-12-01	700.13
            |1991-01-01	770.83
            |1991-02-01	842.31
            |1991-03-01	895.15
            |1991-04-01	898.19
            |1991-05-01	935.29
            |1991-06-01	876.64
            |1991-07-01	923.75
            |1991-08-01	964.1
            |1991-09-01	962.08
            |1991-10-01	989.85
            |1991-11-01	952.45
            |1991-12-01	1065.38
            |1992-01-01	1125.06
            |1992-02-01	1145.31
            |1992-03-01	1086.18
            |1992-04-01	1039.31
            |1992-05-01	1049.46
            |1992-06-01	1007.15
            |1992-07-01	1035.62
            |1992-08-01	1001.23
            |1992-09-01	1034.14
            |1992-10-01	1069.34
            |1992-11-01	1151.42
            |1992-12-01	1195.49
            |1993-01-01	1223.47
            |1993-02-01	1174.52
            |1993-03-01	1204.28
            |1993-04-01	1150.87
            |1993-05-01	1216.82
            |1993-06-01	1221.35
            |1993-07-01	1222.65
            |1993-08-01	1285.11
            |1993-09-01	1317.32
            |1993-10-01	1340.33
            |1993-11-01	1296.04
            |1993-12-01	1334.54
            |1994-01-01	1372.01
            |1994-02-01	1353.59
            |1994-03-01	1265.37
            |1994-04-01	1247.53
            |1994-05-01	1249.09
            |1994-06-01	1195.19
            |1994-07-01	1219.01
            |1994-08-01	1287.77
            |1994-09-01	1281.71
            |1994-10-01	1303.07
            |1994-11-01	1256.04
            |1994-12-01	1258.78
            |1995-01-01	1258.92
            |1995-02-01	1317.59
            |1995-03-01	1352.48
            |1995-04-01	1391.72
            |1995-05-01	1423.1
            |1995-06-01	1533.66
            |1995-07-01	1644.99
            |1995-08-01	1671.96
            |1995-09-01	1706.19
            |1995-10-01	1688.78
            |1995-11-01	1727.56
            |1995-12-01	1717.08
            |1996-01-01	1720.04
            |1996-02-01	1778.78
            |1996-03-01	1772.15
            |1996-04-01	1908.4
            |1996-05-01	1989.49
            |1996-06-01	1894.85
            |1996-07-01	1724.62
            |1996-08-01	1818.41
            |1996-09-01	1948.35
            |1996-10-01	1933.65
            |1996-11-01	2042.32
            |1996-12-01	2039.83
            |1997-01-01	2173.26
            |1997-02-01	2055.13
            |1997-03-01	1913.18
            |1997-04-01	1971.83
            |1997-05-01	2191.5
            |1997-06-01	2253.96
            |1997-07-01	2487.94
            |1997-08-01	2473.04
            |1997-09-01	2619.56
            |1997-10-01	2470.1
            |1997-11-01	2482.45
            |1997-12-01	2438.75
            |1998-01-01	2510.01
            |1998-02-01	2740.75
            |1998-03-01	2836.13
            |1998-04-01	2881.09
            |1998-05-01	2737.68
            |1998-06-01	2912.22
            |1998-07-01	2874.12
            |1998-08-01	2298.35
            |1998-09-01	2593.27
            |1998-10-01	2706.68
            |1998-11-01	2978.9
            |1998-12-01	3352.62
            |1999-01-01	3821.48
            |1999-02-01	3484.67
            |1999-03-01	3736.41
            |1999-04-01	3832.09
            |1999-05-01	3723.07
            |1999-06-01	4047.98
            |1999-07-01	3965.65
            |1999-08-01	4106.29
            |1999-09-01	4097.27
            |1999-10-01	4419.98
            |1999-11-01	4967.54
            |1999-12-01	6059.2
            |2000-01-01	5847.48
            |2000-02-01	6932.31
            |2000-03-01	6690.05
            |2000-04-01	5648.15
            |2000-05-01	4968.73
            |2000-06-01	5762.76
            |2000-07-01	5462.14
            |2000-08-01	6099.21
            |2000-09-01	5296.21
            |2000-10-01	4852.27
            |2000-11-01	3738.42
            |2000-12-01	3557.55
            |2001-01-01	3967.78
            |2001-02-01	3066.36
            |2001-03-01	2616.85
            |2001-04-01	2996.6
            |2001-05-01	2975.79
            |2001-06-01	3042.04
            |2001-07-01	2862.31
            |2001-08-01	2549.27
            |2001-09-01	2105.81
            |2001-10-01	2383.18
            |2001-11-01	2725.98
            |2001-12-01	2765.67
            |2002-01-01	2736.65
            |2002-02-01	2439.67
            |2002-03-01	2585.34
            |2002-04-01	2351.7
            |2002-05-01	2250.71
            |2002-06-01	2038.25
            |2002-07-01	1847.61
            |2002-08-01	1823.7
            |2002-09-01	1622.13
            |2002-10-01	1837.71
            |2002-11-01	2043.67
            |2002-12-01	1849.68
            |2003-01-01	1821.53
            |2003-02-01	1829.73
            |2003-03-01	1823.99
            |2003-04-01	1995.85
            |2003-05-01	2178.42
            |2003-06-01	2213.5
            |2003-07-01	2363.1
            |2003-08-01	2456.78
            |2003-09-01	2417.73
            |2003-10-01	2616.21
            |2003-11-01	2662.03
            |2003-12-01	2722.58
            |2004-01-01	2795.5
            |2004-02-01	2732.14
            |2004-03-01	2666.27
            |2004-04-01	2559.56
            |2004-05-01	2632.43
            |2004-06-01	2705.13
            |2004-07-01	2496.98
            |2004-08-01	2429.97
            |2004-09-01	2501.93
            |2004-10-01	2591.19
            |2004-11-01	2751.01
            |2004-12-01	2865.05
            |2005-01-01	2710.01
            |2005-02-01	2679.55
            |2005-03-01	2591
            |2005-04-01	2473.16
            |2005-05-01	2665.94
            |2005-06-01	2649.36
            |2005-07-01	2800.95
            |2005-08-01	2746.07
            |2005-09-01	2711.13
            |2005-10-01	2667.34
            |2005-11-01	2831.22
            |2005-12-01	2807.37
            |2006-01-01	2912.25
            |2006-02-01	2876.83
            |2006-03-01	2934.1
            |2006-04-01	2886.95
            |2006-05-01	2695.27
            |2006-06-01	2682.53
            |2006-07-01	2574.6
            |2006-08-01	2683.83
            |2006-09-01	2789.16
            |2006-10-01	2939.45
            |2006-11-01	3022.69
            |2006-12-01	2999.79
            |2007-01-01	3050.35
            |2007-02-01	2974.28
            |2007-03-01	2954.4
            |2007-04-01	3060.41
            |2007-05-01	3138.45
            |2007-06-01	3131.69
            |2007-07-01	3063.16
            |2007-08-01	3128.61
            |2007-09-01	3247.2
            |2007-10-01	3428.08
            |2007-11-01	3171.86
            |2007-12-01	3164.17
            |2008-01-01	2836.76
            |2008-02-01	2689.43
            |2008-03-01	2673.38
            |2008-04-01	2813.32
            |2008-05-01	2918.72
            |2008-06-01	2625.46
            |2008-07-01	2648.8
            |2008-08-01	2708.44
            |2008-09-01	2395.2
            |2008-10-01	1991.14
            |2008-11-01	1810.44
            |2008-12-01	1879.82
            |2009-01-01	1752.51
            |2009-02-01	1627.23
            |2009-03-01	1800.68
            |2009-04-01	2017.83
            |2009-05-01	2079.51
            |2009-06-01	2132.32
            |2009-07-01	2301
            |2009-08-01	2332.52
            |2009-09-01	2462.01
            |2009-10-01	2370.28
            |2009-11-01	2483.45
            |2009-12-01	2632.21
            |2010-01-01	2482.34
            |2010-02-01	2587.43
            |2010-03-01	2760.05
            |2010-04-01	2827.91
            |2010-05-01	2591.08
            |2010-06-01	2423.52
            |2010-07-01	2590.65
            |2010-08-01	2426.91
            |2010-09-01	2716.81
            |2010-10-01	2873.49
            |2010-11-01	2860.47
            |2010-12-01	3032.23
            |2011-01-01	3072.69
            |2011-02-01	3149.53
            |2011-03-01	3117.58
            |2011-04-01	3201.12
            |2011-05-01	3144.35
            |2011-06-01	3078.61
            |2011-07-01	3056.83
            |2011-08-01	2852.88
            |2011-09-01	2666.6
            |2011-10-01	2971.64
            |2011-11-01	2900.72
            |2011-12-01	2891.72
            |2012-01-01	3109.29
            |2012-02-01	3266.55
            |2012-03-01	3375.99
            |2012-04-01	3317.49
            |2012-05-01	3081.8
            |2012-06-01	3205.07
            |2012-07-01	3215.83
            |2012-08-01	3336.85
            |2012-09-01	3374.88
            |2012-10-01	3224.34
            |2012-11-01	3275.14
            |2012-12-01	3294.29
            |2013-01-01	3418.64
            |2013-02-01	3409.85
            |2013-03-01	3515.85
            |2013-04-01	3585.11
            |2013-05-01	3718.56
            |2013-06-01	3651.69
            |2013-07-01	3891.1
            |2013-08-01	3844.75
            |2013-09-01	4035.48
            |2013-10-01	4205.85
            |2013-11-01	4364.38
            |2013-12-01	4489.83
            |2014-01-01	4395.26
            |2014-02-01	4596.76
            |2014-03-01	4450.93
            |2014-04-01	4349.09
            |2014-05-01	4467.48
            |2014-06-01	4633
            |2014-07-01	4597
            |2014-08-01	4823.02
            |2014-09-01	4731.54
            |2014-10-01	4885.43
            |2014-11-01	5083.92
            |2014-12-01	5053.37
            |2015-01-01	4968.98
            |2015-02-01	5296.09
            |2015-03-01	5199.83
            |2015-04-01	5232.96
            |2015-05-01	5343.81
            |2015-06-01	5236.21
            |2015-07-01	5384.69
            |2015-08-01	5020.11
            |2015-09-01	4865.03
            |2015-10-01	5321.6
            |2015-11-01	5394.76
            |2015-12-01	5302.85
            |2016-01-01	4881.56
            |2016-02-01	4817.75
            |2016-03-01	5123.08
            |2016-04-01	4999.8
            |2016-05-01	5160.82
            |2016-06-01	5036.38
            |2016-07-01	5306.63""".stripMargin



  def main(args: Array[String]): Unit = {
    val d: Seq[(String, Double)] = data.split("\n").toVector.map { x =>
      val all = x.split("\t")
      (all(0), all(1).toDouble)
    }

    val yearPeriod = 10
    val nbMonths = yearPeriod * 12
    (0 until d.size - nbMonths).foreach { i =>
      val total = (i until i + nbMonths).foldLeft(0.0) { case (current, index) =>
          current + 1000 / d(index)._2
      }
      val lastValue = d(i + nbMonths - 1)._2 * total
      val cf = (0 until nbMonths) map {
        case idx if idx < nbMonths - 1 => CashFlow(-1000.0, idx / 12.0)
        case idx if idx == nbMonths - 1 => CashFlow(-1000.0 + lastValue, idx / 12.0)
        case _ => throw new RuntimeException("This is just impossible")
      }
      println(d(i)._1, InternalRateOfReturn.computeInternalRateOfReturn(cf.toList))

    }

  }

}
