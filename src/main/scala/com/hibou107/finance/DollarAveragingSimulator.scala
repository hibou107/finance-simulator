package com.hibou107.finance

import com.hibou107.finance.InternalRateOfReturn.CashFlow

object DollarAveragingSimulator {
  val data = """01/02/1971	100.000000
               |01/03/1971	101.779999
               |01/04/1971	106.339996
               |01/05/1971	111.349998
               |01/06/1971	108.870003
               |01/07/1971	108.470001
               |01/08/1971	105.589996
               |01/09/1971	108.650002
               |01/10/1971	109.580002
               |01/11/1971	103.690002
               |01/12/1971	105.000000
               |01/01/1972	113.650002
               |01/02/1972	119.580002
               |01/03/1972	126.290001
               |01/04/1972	128.059998
               |01/05/1972	130.160004
               |01/06/1972	133.130005
               |01/07/1972	130.589996
               |01/08/1972	128.449997
               |01/09/1972	130.699997
               |01/10/1972	129.300003
               |01/11/1972	131.589996
               |01/12/1972	133.940002
               |01/01/1973	134.630005
               |01/02/1973	126.940002
               |01/03/1973	119.529999
               |01/04/1973	115.790001
               |01/05/1973	107.959999
               |01/06/1973	102.300003
               |01/07/1973	100.150002
               |01/08/1973	107.129997
               |01/09/1973	105.500000
               |01/10/1973	110.970001
               |01/11/1973	109.620003
               |01/12/1973	91.970001
               |01/01/1974	92.529999
               |01/02/1974	94.150002
               |01/03/1974	94.050003
               |01/04/1974	91.900002
               |01/05/1974	87.629997
               |01/06/1974	81.080002
               |01/07/1974	75.389999
               |01/08/1974	69.629997
               |01/09/1974	60.880001
               |01/10/1974	55.480000
               |01/11/1974	65.059998
               |01/12/1974	61.660000
               |01/01/1975	60.700001
               |01/02/1975	70.730003
               |01/03/1975	73.830002
               |01/04/1975	75.419998
               |01/05/1975	79.269997
               |01/06/1975	83.879997
               |01/07/1975	86.330002
               |01/08/1975	81.620003
               |01/09/1975	77.889999
               |01/10/1975	73.800003
               |01/11/1975	76.620003
               |01/12/1975	78.660004
               |01/01/1976	78.059998
               |01/02/1976	87.279999
               |01/03/1976	90.250000
               |01/04/1976	90.440002
               |01/05/1976	89.050003
               |01/06/1976	87.809998
               |01/07/1976	90.279999
               |01/08/1976	91.269997
               |01/09/1976	90.589996
               |01/10/1976	90.440002
               |01/11/1976	90.389999
               |01/12/1976	91.830002
               |01/01/1977	97.690002
               |01/02/1977	96.300003
               |01/03/1977	95.139999
               |01/04/1977	94.540001
               |01/05/1977	95.830002
               |01/06/1977	95.860001
               |01/07/1977	99.900002
               |01/08/1977	100.760002
               |01/09/1977	100.400002
               |01/10/1977	101.160004
               |01/11/1977	96.739998
               |01/12/1977	103.680000
               |01/01/1978	104.000000
               |01/02/1978	101.540001
               |01/03/1978	101.470001
               |01/04/1978	105.889999
               |01/05/1978	115.959999
               |01/06/1978	120.339996
               |01/07/1978	120.150002
               |01/08/1978	126.809998
               |01/09/1978	135.350006
               |01/10/1978	133.300003
               |01/11/1978	114.650002
               |01/12/1978	116.190002
               |01/01/1979	117.839996
               |01/02/1979	125.760002
               |01/03/1979	123.330002
               |01/04/1979	131.360001
               |01/05/1979	133.789993
               |01/06/1979	131.759995
               |01/07/1979	137.029999
               |01/08/1979	141.899994
               |01/09/1979	148.490005
               |01/10/1979	149.589996
               |01/11/1979	136.419998
               |01/12/1979	143.860001
               |01/01/1980	148.169998
               |01/02/1980	162.300003
               |01/03/1980	156.869995
               |01/04/1980	133.139999
               |01/05/1980	139.679993
               |01/06/1980	150.169998
               |01/07/1980	158.169998
               |01/08/1980	172.490005
               |01/09/1980	182.339996
               |01/10/1980	189.619995
               |01/11/1980	193.149994
               |01/12/1980	204.910004
               |01/01/1981	203.550003
               |01/02/1981	193.089996
               |01/03/1981	199.059998
               |01/04/1981	211.339996
               |01/05/1981	216.679993
               |01/06/1981	223.020004
               |01/07/1981	214.630005
               |01/08/1981	210.399994
               |01/09/1981	195.169998
               |01/10/1981	181.089996
               |01/11/1981	197.250000
               |01/12/1981	201.130005
               |01/01/1982	195.529999
               |01/02/1982	186.820007
               |01/03/1982	180.130005
               |01/04/1982	177.309998
               |01/05/1982	184.970001
               |01/06/1982	177.360001
               |01/07/1982	170.600006
               |01/08/1982	168.369995
               |01/09/1982	177.300003
               |01/10/1982	188.699997
               |01/11/1982	214.520004
               |01/12/1982	235.589996
               |01/01/1983	230.589996
               |01/02/1983	248.149994
               |01/03/1983	261.820007
               |01/04/1983	268.730011
               |01/05/1983	290.540009
               |01/06/1983	307.950012
               |01/07/1983	321.579987
               |01/08/1983	302.079987
               |01/09/1983	294.549988
               |01/10/1983	294.640015
               |01/11/1983	273.040009
               |01/12/1983	286.070007
               |01/01/1984	277.630005
               |01/02/1984	266.429993
               |01/03/1984	253.500000
               |01/04/1984	249.800003
               |01/05/1984	250.259995
               |01/06/1984	235.899994
               |01/07/1984	237.910004
               |01/08/1984	233.350006
               |01/09/1984	251.389999
               |01/10/1984	247.860001
               |01/11/1984	247.100006
               |01/12/1984	241.899994
               |01/01/1985	247.100006
               |01/02/1985	277.899994
               |01/03/1985	285.100006
               |01/04/1985	279.500000
               |01/05/1985	280.500000
               |01/06/1985	291.399994
               |01/07/1985	295.899994
               |01/08/1985	302.600006
               |01/09/1985	297.299988
               |01/10/1985	280.600006
               |01/11/1985	293.000000
               |01/12/1985	313.899994
               |01/01/1986	325.000000
               |01/02/1986	336.100006
               |01/03/1986	360.000000
               |01/04/1986	375.799988
               |01/05/1986	383.200012
               |01/06/1986	400.700012
               |01/07/1986	407.000000
               |01/08/1986	372.500000
               |01/09/1986	382.799988
               |01/10/1986	352.500000
               |01/11/1986	361.000000
               |01/12/1986	357.399994
               |01/01/1987	351.299988
               |01/02/1987	393.799988
               |01/03/1987	425.000000
               |01/04/1987	426.299988
               |01/05/1987	418.600006
               |01/06/1987	415.500000
               |01/07/1987	424.500000
               |01/08/1987	433.299988
               |01/09/1987	455.500000
               |01/10/1987	446.200012
               |01/11/1987	325.399994
               |01/12/1987	306.399994
               |01/01/1988	335.100006
               |01/02/1988	346.200012
               |01/03/1988	367.399994
               |01/04/1988	373.700012
               |01/05/1988	379.000000
               |01/06/1988	372.700012
               |01/07/1988	394.200012
               |01/08/1988	387.600006
               |01/09/1988	374.200012
               |01/10/1988	384.700012
               |01/11/1988	382.700012
               |01/12/1988	372.100006
               |01/01/1989	378.899994
               |01/02/1989	401.799988
               |01/03/1989	401.000000
               |01/04/1989	407.000000
               |01/05/1989	425.899994
               |01/06/1989	446.799988
               |01/07/1989	434.500000
               |01/08/1989	455.200012
               |01/09/1989	469.899994
               |01/10/1989	472.799988
               |01/11/1989	456.200012
               |01/12/1989	456.600006
               |01/01/1990	452.899994
               |01/02/1990	416.799988
               |01/03/1990	425.299988
               |01/04/1990	431.600006
               |01/05/1990	422.000000
               |01/06/1990	459.500000
               |01/07/1990	461.600006
               |01/08/1990	437.700012
               |01/09/1990	379.000000
               |01/10/1990	349.000000
               |01/11/1990	328.600006
               |01/12/1990	361.100006
               |01/01/1991	373.000000
               |01/02/1991	415.100006
               |01/03/1991	450.600006
               |01/04/1991	480.179993
               |01/05/1991	481.940002
               |01/06/1991	505.839996
               |01/07/1991	478.059998
               |01/08/1991	502.269989
               |01/09/1991	526.299988
               |01/10/1991	527.140015
               |01/11/1991	542.169983
               |01/12/1991	519.479980
               |01/01/1992	580.039978
               |01/02/1992	620.570007
               |01/03/1992	634.039978
               |01/04/1992	598.619995
               |01/05/1992	579.729980
               |01/06/1992	583.669983
               |01/07/1992	563.729980
               |01/08/1992	579.619995
               |01/09/1992	562.510010
               |01/10/1992	581.080017
               |01/11/1992	603.760010
               |01/12/1992	650.580017
               |01/01/1993	675.309998
               |01/02/1993	697.979980
               |01/03/1993	670.880005
               |01/04/1993	690.820007
               |01/05/1993	662.750000
               |01/06/1993	700.960022
               |01/07/1993	702.010010
               |01/08/1993	706.380005
               |01/09/1993	743.650024
               |01/10/1993	761.619995
               |01/11/1993	780.369995
               |01/12/1993	759.900024
               |01/01/1994	774.109985
               |01/02/1994	798.419983
               |01/03/1994	792.099976
               |01/04/1994	723.059998
               |01/05/1994	733.969971
               |01/06/1994	733.179993
               |01/07/1994	706.289978
               |01/08/1994	722.840027
               |01/09/1994	763.000000
               |01/10/1994	764.469971
               |01/11/1994	776.250000
               |01/12/1994	748.830017
               |01/01/1995	751.309998
               |01/02/1995	756.679993
               |01/03/1995	794.330017
               |01/04/1995	816.059998
               |01/05/1995	844.719971
               |01/06/1995	865.669983
               |01/07/1995	933.989990
               |01/08/1995	1001.570007
               |01/09/1995	1019.419983
               |01/10/1995	1041.390015
               |01/11/1995	1037.300049
               |01/12/1995	1060.660034
               |01/01/1996	1052.829956
               |01/02/1996	1058.260010
               |01/03/1996	1098.939941
               |01/04/1996	1105.770020
               |01/05/1996	1190.479980
               |01/06/1996	1242.540039
               |01/07/1996	1185.640015
               |01/08/1996	1081.339966
               |01/09/1996	1133.300049
               |01/10/1996	1223.729980
               |01/11/1996	1223.719971
               |01/12/1996	1294.780029
               |01/01/1997	1292.650024
               |01/02/1997	1383.969971
               |01/03/1997	1306.209961
               |01/04/1997	1211.280029
               |01/05/1997	1263.930054
               |01/06/1997	1407.069946
               |01/07/1997	1442.650024
               |01/08/1997	1594.670044
               |01/09/1997	1595.069946
               |01/10/1997	1690.790039
               |01/11/1997	1609.619995
               |01/12/1997	1608.560059
               |01/01/1998	1574.099976
               |01/02/1998	1640.060059
               |01/03/1998	1778.719971
               |01/04/1998	1838.150024
               |01/05/1998	1871.810059
               |01/06/1998	1770.369995
               |01/07/1998	1904.239990
               |01/08/1998	1869.719971
               |01/09/1998	1509.010010
               |01/10/1998	1663.300049
               |01/11/1998	1783.709961
               |01/12/1998	1928.510010
               |01/01/1999	2207.540039
               |01/02/1999	2522.379883
               |01/03/1999	2286.830078
               |01/04/1999	2493.070068
               |01/05/1999	2546.330078
               |01/06/1999	2467.510010
               |01/07/1999	2692.959961
               |01/08/1999	2638.310059
               |01/09/1999	2752.330078
               |01/10/1999	2729.040039
               |01/11/1999	2970.929932
               |01/12/1999	3341.100098
               |01/01/2000	4186.189941
               |01/02/2000	3961.070068
               |01/03/2000	4732.819824
               |01/04/2000	4494.890137
               |01/05/2000	3930.179932
               |01/06/2000	3471.949951
               |01/07/2000	3950.590088
               |01/08/2000	3760.949951
               |01/09/2000	4252.149902
               |01/10/2000	3714.479980
               |01/11/2000	3316.510010
               |01/12/2000	2644.090088
               |01/01/2001	2474.159912
               |01/02/2001	2771.570068
               |01/03/2001	2126.300049
               |01/04/2001	1835.219971
               |01/05/2001	2116.239990
               |01/06/2001	2131.120117
               |01/07/2001	2156.760010
               |01/08/2001	2051.560059
               |01/09/2001	1802.290039
               |01/10/2001	1491.449951
               |01/11/2001	1705.520020
               |01/12/2001	1915.130005
               |01/01/2002	1965.180054
               |01/02/2002	1928.829956
               |01/03/2002	1745.489990
               |01/04/2002	1834.589966
               |01/05/2002	1683.760010
               |01/06/2002	1613.500000
               |01/07/2002	1457.040039
               |01/08/2002	1322.469971
               |01/09/2002	1302.670044
               |01/10/2002	1180.260010
               |01/11/2002	1320.949951
               |01/12/2002	1507.939941
               |01/01/2003	1346.930054
               |01/02/2003	1324.739990
               |01/03/2003	1344.209961
               |01/04/2003	1347.540039
               |01/05/2003	1463.000000
               |01/06/2003	1612.099976
               |01/07/2003	1617.300049
               |01/08/2003	1731.630005
               |01/09/2003	1817.920044
               |01/10/2003	1797.069946
               |01/11/2003	1941.310059
               |01/12/2003	1972.969971
               |01/01/2004	2011.079956
               |01/02/2004	2072.129883
               |01/03/2004	2036.920044
               |01/04/2004	1996.449951
               |01/05/2004	1928.719971
               |01/06/2004	1978.520020
               |01/07/2004	2045.530029
               |01/08/2004	1874.930054
               |01/09/2004	1833.369995
               |01/10/2004	1909.589966
               |01/11/2004	1975.479980
               |01/12/2004	2104.580078
               |01/01/2005	2184.750000
               |01/02/2005	2063.270020
               |01/03/2005	2057.469971
               |01/04/2005	2009.089966
               |01/05/2005	1923.229980
               |01/06/2005	2067.229980
               |01/07/2005	2060.969971
               |01/08/2005	2191.489990
               |01/09/2005	2150.030029
               |01/10/2005	2152.699951
               |01/11/2005	2109.889893
               |01/12/2005	2244.850098
               |01/01/2006	2216.530029
               |01/02/2006	2294.110107
               |01/03/2006	2288.149902
               |01/04/2006	2352.239990
               |01/05/2006	2329.790039
               |01/06/2006	2179.820068
               |01/07/2006	2177.909912
               |01/08/2006	2080.340088
               |01/09/2006	2194.560059
               |01/10/2006	2257.000000
               |01/11/2006	2373.489990
               |01/12/2006	2430.750000
               |01/01/2007	2429.719971
               |01/02/2007	2474.080078
               |01/03/2007	2377.179932
               |01/04/2007	2425.360107
               |01/05/2007	2529.949951
               |01/06/2007	2614.010010
               |01/07/2007	2617.389893
               |01/08/2007	2538.500000
               |01/09/2007	2596.379883
               |01/10/2007	2704.250000
               |01/11/2007	2835.000000
               |01/12/2007	2654.909912
               |01/01/2008	2653.909912
               |01/02/2008	2392.580078
               |01/03/2008	2271.260010
               |01/04/2008	2306.510010
               |01/05/2008	2416.489990
               |01/06/2008	2514.820068
               |01/07/2008	2274.239990
               |01/08/2008	2326.830078
               |01/09/2008	2402.110107
               |01/10/2008	2075.100098
               |01/11/2008	1718.890015
               |01/12/2008	1496.089966
               |01/01/2009	1578.869995
               |01/02/2009	1460.849976
               |01/03/2009	1356.130005
               |01/04/2009	1504.869995
               |01/05/2009	1719.290039
               |01/06/2009	1796.089966
               |01/07/2009	1846.119995
               |01/08/2009	1998.349976
               |01/09/2009	2001.300049
               |01/10/2009	2111.770020
               |01/11/2009	2047.420044
               |01/12/2009	2162.229980
               |01/01/2010	2294.409912
               |01/02/2010	2155.810059
               |01/03/2010	2247.399902
               |01/04/2010	2411.679932
               |01/05/2010	2472.320068
               |01/06/2010	2244.790039
               |01/07/2010	2110.750000
               |01/08/2010	2283.320068
               |01/09/2010	2142.750000
               |01/10/2010	2386.820068
               |01/11/2010	2520.449951
               |01/12/2010	2535.189941
               |01/01/2011	2676.649902
               |01/02/2011	2717.610107
               |01/03/2011	2791.080078
               |01/04/2011	2796.669922
               |01/05/2011	2881.280029
               |01/06/2011	2829.389893
               |01/07/2011	2775.080078
               |01/08/2011	2791.449951
               |01/09/2011	2583.340088
               |01/10/2011	2401.189941
               |01/11/2011	2607.310059
               |01/12/2011	2615.669922
               |01/01/2012	2657.389893
               |01/02/2012	2830.100098
               |01/03/2012	2979.110107
               |01/04/2012	3085.939941
               |01/05/2012	3044.790039
               |01/06/2012	2810.129883
               |01/07/2012	2938.409912
               |01/08/2012	2956.719971
               |01/09/2012	3063.250000
               |01/10/2012	3130.310059
               |01/11/2012	2987.540039
               |01/12/2012	3029.209961
               |01/01/2013	3091.330078
               |01/02/2013	3162.939941
               |01/03/2013	3143.540039
               |01/04/2013	3268.629883
               |01/05/2013	3325.350098
               |01/06/2013	3460.760010
               |01/07/2013	3430.479980
               |01/08/2013	3654.179932
               |01/09/2013	3622.639893
               |01/10/2013	3774.179932
               |01/11/2013	3932.449951
               |01/12/2013	4065.659912
               |01/01/2014	4160.029785
               |01/02/2014	4105.060059
               |01/03/2014	4261.419922
               |01/04/2014	4219.870117
               |01/05/2014	4121.250000
               |01/06/2014	4247.959961
               |01/07/2014	4424.709961
               |01/08/2014	4363.390137
               |01/09/2014	4592.419922
               |01/10/2014	4486.649902
               |01/11/2014	4633.709961
               |01/12/2014	4777.729980
               |01/01/2015	4760.240234
               |01/02/2015	4650.600098
               |01/03/2015	4973.430176
               |01/04/2015	4894.359863
               |01/05/2015	4966.319824
               |01/06/2015	5094.939941
               |01/07/2015	5029.049805
               |01/08/2015	5134.339844
               |01/09/2015	4673.609863
               |01/10/2015	4624.459961
               |01/11/2015	5065.640137
               |01/12/2015	5129.640137
               |01/01/2016	4897.649902
               |01/02/2016	4587.589844
               |01/03/2016	4596.009766
               |01/04/2016	4842.549805
               |01/05/2016	4786.549805
               |01/06/2016	4928.970215
               |01/07/2016	4837.180176
               |01/08/2016	5167.419922
               |01/09/2016	5218.279785
               |01/10/2016	5300.290039
               |01/11/2016	5199.770020
               |01/12/2016	5323.879883
               |01/01/2017	5425.620117
               |01/02/2017	5654.509766
               |01/03/2017	5874.859863
               |01/04/2017	5917.319824
               |01/05/2017	6067.560059
               |01/06/2017	6215.910156
               |01/07/2017	6173.290039
               |01/08/2017	6372.160156
               |01/09/2017	6442.169922
               |01/10/2017	6506.080078
               |01/11/2017	6758.640137
               |01/12/2017	6844.040039
               |01/01/2018	6937.649902
               |01/02/2018	7377.169922
               |01/03/2018	7274.750000
               |01/04/2018	7016.169922
               |01/05/2018	7053.649902""".stripMargin



  def main(args: Array[String]): Unit = {
    val d: Seq[(String, Double)] = data.split("\n").toVector.map { x =>
      val all = x.split("\t")
      (all(0), all(1).toDouble)
    }

    val yearPeriod = 8
    val nbMonths = yearPeriod * 12
    (0 until d.size - nbMonths).foreach { i =>
      val total = (i until i + nbMonths).foldLeft(0.0) { case (current, index) =>
          current + 1000 / d(index)._2
      }
      val lastValue = d(i + nbMonths - 1)._2 * total
      val cf = (0 until nbMonths) map {
        case idx if idx < nbMonths - 1 => CashFlow(-1000.0, idx / 12.0)
        case idx if idx == nbMonths - 1 => CashFlow(-1000.0 + lastValue, idx / 12.0)
        case _ => throw new RuntimeException("This is just impossible")
      }
      println(d(i)._1, InternalRateOfReturn.computeInternalRateOfReturn(cf.toList))

    }

  }

}
