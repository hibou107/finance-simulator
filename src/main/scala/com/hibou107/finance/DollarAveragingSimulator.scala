package com.hibou107.finance

import com.hibou107.finance.InternalRateOfReturn.CashFlow

object DollarAveragingSimulator {
  val data = """01/01/1988	256.019989
               |01/02/1988	255.509995
               |01/03/1988	269.440002
               |01/04/1988	258.410004
               |01/05/1988	264.329987
               |01/06/1988	270.950012
               |01/07/1988	276.859985
               |01/08/1988	277.760010
               |01/09/1988	264.850006
               |01/10/1988	279.089996
               |01/11/1988	287.510010
               |01/12/1988	281.950012
               |01/01/1989	285.649994
               |01/02/1989	308.859985
               |01/03/1989	299.769989
               |01/04/1989	310.209991
               |01/05/1989	324.109985
               |01/06/1989	339.250000
               |01/07/1989	337.190002
               |01/08/1989	363.769989
               |01/09/1989	375.779999
               |01/10/1989	373.589996
               |01/11/1989	364.010010
               |01/12/1989	375.519989
               |01/01/1990	386.160004
               |01/02/1990	353.679993
               |01/03/1990	359.459991
               |01/04/1990	366.720001
               |01/05/1990	360.480011
               |01/06/1990	395.940002
               |01/07/1990	392.809998
               |01/08/1990	389.220001
               |01/09/1990	355.320007
               |01/10/1990	347.299988
               |01/11/1990	339.350006
               |01/12/1990	360.000000
               |01/01/1991	363.440002
               |01/02/1991	382.679993
               |01/03/1991	414.920013
               |01/04/1991	416.739990
               |01/05/1991	427.589996
               |01/06/1991	438.380005
               |01/07/1991	427.730011
               |01/08/1991	438.890015
               |01/09/1991	446.390015
               |01/10/1991	444.079987
               |01/11/1991	447.200012
               |01/12/1991	437.670013
               |01/01/1992	479.839996
               |01/02/1992	471.679993
               |01/03/1992	476.660004
               |01/04/1992	468.160004
               |01/05/1992	478.450012
               |01/06/1992	486.040009
               |01/07/1992	481.950012
               |01/08/1992	497.049988
               |01/09/1992	488.230011
               |01/10/1992	489.660004
               |01/11/1992	498.079987
               |01/12/1992	509.420013
               |01/01/1993	516.000000
               |01/02/1993	525.030029
               |01/03/1993	526.070007
               |01/04/1993	537.090027
               |01/05/1993	528.549988
               |01/06/1993	544.200012
               |01/07/1993	539.559998
               |01/08/1993	541.750000
               |01/09/1993	559.200012
               |01/10/1993	558.239990
               |01/11/1993	568.489990
               |01/12/1993	561.580017
               |01/01/1994	567.099976
               |01/02/1994	585.270020
               |01/03/1994	568.330017
               |01/04/1994	538.369995
               |01/05/1994	556.440002
               |01/06/1994	564.190002
               |01/07/1994	551.469971
               |01/08/1994	570.539978
               |01/09/1994	587.450012
               |01/10/1994	574.820007
               |01/11/1994	583.979980
               |01/12/1994	561.429993
               |01/01/1995	575.520020
               |01/02/1995	590.650024
               |01/03/1995	611.640015
               |01/04/1995	633.330017
               |01/05/1995	649.950012
               |01/06/1995	676.530029
               |01/07/1995	695.080017
               |01/08/1995	711.950012
               |01/09/1995	719.340027
               |01/10/1995	743.650024
               |01/11/1995	748.010010
               |01/12/1995	779.150024
               |01/01/1996	798.219971
               |01/02/1996	822.299988
               |01/03/1996	831.700012
               |01/04/1996	845.200012
               |01/05/1996	847.489990
               |01/06/1996	866.830017
               |01/07/1996	878.969971
               |01/08/1996	846.770020
               |01/09/1996	854.630005
               |01/10/1996	901.289978
               |01/11/1996	921.909973
               |01/12/1996	993.000000
               |01/01/1997	969.049988
               |01/02/1997	1035.589966
               |01/03/1997	1048.780029
               |01/04/1997	1003.330017
               |01/05/1997	1056.130005
               |01/06/1997	1121.689941
               |01/07/1997	1182.569946
               |01/08/1997	1258.589966
               |01/09/1997	1234.439941
               |01/10/1997	1273.510010
               |01/11/1997	1252.959961
               |01/12/1997	1302.819946
               |01/01/1998	1305.040039
               |01/02/1998	1341.319946
               |01/03/1998	1405.729980
               |01/04/1998	1488.699951
               |01/05/1998	1507.329956
               |01/06/1998	1469.459961
               |01/07/1998	1548.770020
               |01/08/1998	1501.530029
               |01/09/1998	1343.939941
               |01/10/1998	1335.359985
               |01/11/1998	1506.310059
               |01/12/1998	1594.869995
               |01/01/1999	1668.520020
               |01/02/1999	1730.810059
               |01/03/1999	1682.859985
               |01/04/1999	1763.310059
               |01/05/1999	1847.630005
               |01/06/1999	1767.800049
               |01/07/1999	1888.150024
               |01/08/1999	1817.270020
               |01/09/1999	1824.199951
               |01/10/1999	1759.770020
               |01/11/1999	1858.859985
               |01/12/1999	1921.489990
               |01/01/2000	2002.109985
               |01/02/2000	1940.239990
               |01/03/2000	1901.510010
               |01/04/2000	2077.969971
               |01/05/2000	2027.400024
               |01/06/2000	2003.449951
               |01/07/2000	2033.579956
               |01/08/2000	1991.430054
               |01/09/2000	2108.760010
               |01/10/2000	1992.939941
               |01/11/2000	1973.719971
               |01/12/2000	1828.810059
               |01/01/2001	1785.859985
               |01/02/2001	1913.109985
               |01/03/2001	1730.920044
               |01/04/2001	1599.359985
               |01/05/2001	1769.119995
               |01/06/2001	1763.869995
               |01/07/2001	1731.530029
               |01/08/2001	1704.239990
               |01/09/2001	1590.290039
               |01/10/2001	1459.329956
               |01/11/2001	1524.959961
               |01/12/2001	1591.479980
               |01/01/2002	1628.510010
               |01/02/2002	1584.060059
               |01/03/2002	1600.020020
               |01/04/2002	1622.229980
               |01/05/2002	1538.650024
               |01/06/2002	1476.260010
               |01/07/2002	1375.880005
               |01/08/2002	1258.219971
               |01/09/2002	1250.680054
               |01/10/2002	1209.589966
               |01/11/2002	1287.130005
               |01/12/2002	1337.349976
               |01/01/2003	1303.170044
               |01/02/2003	1234.790039
               |01/03/2003	1200.599976
               |01/04/2003	1236.300049
               |01/05/2003	1321.390015
               |01/06/2003	1396.699951
               |01/07/2003	1421.030029
               |01/08/2003	1419.640015
               |01/09/2003	1482.609985
               |01/10/2003	1479.229980
               |01/11/2003	1540.709961
               |01/12/2003	1559.500000
               |01/01/2004	1618.050049
               |01/02/2004	1658.790039
               |01/03/2004	1691.900024
               |01/04/2004	1659.160034
               |01/05/2004	1639.459961
               |01/06/2004	1647.569946
               |01/07/2004	1661.530029
               |01/08/2004	1630.479980
               |01/09/2004	1632.819946
               |01/10/2004	1672.489990
               |01/11/2004	1673.109985
               |01/12/2004	1766.900024
               |01/01/2005	1784.959961
               |01/02/2005	1767.790039
               |01/03/2005	1802.790039
               |01/04/2005	1749.449951
               |01/05/2005	1735.430054
               |01/06/2005	1799.150024
               |01/07/2005	1789.849976
               |01/08/2005	1853.130005
               |01/09/2005	1836.369995
               |01/10/2005	1846.170044
               |01/11/2005	1812.109985
               |01/12/2005	1910.229980
               |01/01/2006	1918.959961
               |01/02/2006	1941.750000
               |01/03/2006	1959.770020
               |01/04/2006	1971.930054
               |01/05/2006	1985.550049
               |01/06/2006	1960.280029
               |01/07/2006	1954.489990
               |01/08/2006	1942.219971
               |01/09/2006	2008.469971
               |01/10/2006	2041.989990
               |01/11/2006	2100.370117
               |01/12/2006	2149.850098
               |01/01/2007	2183.919922
               |01/02/2007	2231.610107
               |01/03/2007	2170.169922
               |01/04/2007	2205.850098
               |01/05/2007	2303.679932
               |01/06/2007	2386.629883
               |01/07/2007	2363.280029
               |01/08/2007	2282.300049
               |01/09/2007	2323.830078
               |01/10/2007	2417.439941
               |01/11/2007	2360.209961
               |01/12/2007	2308.739990
               |01/01/2008	2273.409912
               |01/02/2008	2194.429932
               |01/03/2008	2098.639893
               |01/04/2008	2163.379883
               |01/05/2008	2228.090088
               |01/06/2008	2195.270020
               |01/07/2008	2039.660034
               |01/08/2008	2003.160034
               |01/09/2008	2035.239990
               |01/10/2008	1853.260010
               |01/11/2008	1544.910034
               |01/12/2008	1309.390015
               |01/01/2009	1499.170044
               |01/02/2009	1329.810059
               |01/03/2009	1133.430054
               |01/04/2009	1293.229980
               |01/05/2009	1416.750000
               |01/06/2009	1495.969971
               |01/07/2009	1499.109985
               |01/08/2009	1612.319946
               |01/09/2009	1670.589966
               |01/10/2009	1732.680054
               |01/11/2009	1700.719971
               |01/12/2009	1803.099976
               |01/01/2010	1867.060059
               |01/02/2010	1796.670044
               |01/03/2010	1826.270020
               |01/04/2010	1938.079956
               |01/05/2010	1967.510010
               |01/06/2010	1810.010010
               |01/07/2010	1715.229980
               |01/08/2010	1837.689941
               |01/09/2010	1754.859985
               |01/10/2010	1911.099976
               |01/11/2010	1983.550049
               |01/12/2010	1986.349976
               |01/01/2011	2115.969971
               |01/02/2011	2165.770020
               |01/03/2011	2239.120117
               |01/04/2011	2239.449951
               |01/05/2011	2305.760010
               |01/06/2011	2279.659912
               |01/07/2011	2241.659912
               |01/08/2011	2196.600098
               |01/09/2011	2077.159912
               |01/10/2011	1930.430054
               |01/11/2011	2137.879883
               |01/12/2011	2137.080078
               |01/01/2012	2158.929932
               |01/02/2012	2255.760010
               |01/03/2012	2353.229980
               |01/04/2012	2430.679932
               |01/05/2012	2415.409912
               |01/06/2012	2270.250000
               |01/07/2012	2364.090088
               |01/08/2012	2396.610107
               |01/09/2012	2450.540039
               |01/10/2012	2514.320068
               |01/11/2012	2467.510010
               |01/12/2012	2481.820068
               |01/01/2013	2504.449951
               |01/02/2013	2634.159912
               |01/03/2013	2669.919922
               |01/04/2013	2770.060059
               |01/05/2013	2823.429932
               |01/06/2013	2891.179932
               |01/07/2013	2856.879883
               |01/08/2013	3002.580078
               |01/09/2013	2914.419922
               |01/10/2013	3001.919922
               |01/11/2013	3141.949951
               |01/12/2013	3235.179932
               |01/01/2014	3311.580078
               |01/02/2014	3201.120117
               |01/03/2014	3344.360107
               |01/04/2014	3378.659912
               |01/05/2014	3401.479980
               |01/06/2014	3481.149902
               |01/07/2014	3556.560059
               |01/08/2014	3501.610107
               |01/09/2014	3644.770020
               |01/10/2014	3591.020020
               |01/11/2014	3680.310059
               |01/12/2014	3775.870117
               |01/01/2015	3776.489990
               |01/02/2015	3659.449951
               |01/03/2015	3867.979980
               |01/04/2015	3805.270020
               |01/05/2015	3845.229980
               |01/06/2015	3893.879883
               |01/07/2015	3823.979980
               |01/08/2015	3897.010010
               |01/09/2015	3657.040039
               |01/10/2015	3569.719971
               |01/11/2015	3873.939941
               |01/12/2015	3887.860107
               |01/01/2016	3811.739990
               |01/02/2016	3625.889893
               |01/03/2016	3636.250000
               |01/04/2016	3867.280029
               |01/05/2016	3891.679932
               |01/06/2016	3952.929932
               |01/07/2016	3969.850098
               |01/08/2016	4113.660156
               |01/09/2016	4121.060059
               |01/10/2016	4114.089844
               |01/11/2016	4050.739990
               |01/12/2016	4198.490234
               |01/01/2017	4303.120117
               |01/02/2017	4373.649902
               |01/03/2017	4565.379883
               |01/04/2017	4537.709961
               |01/05/2017	4593.109863
               |01/06/2017	4657.330078
               |01/07/2017	4694.189941
               |01/08/2017	4787.729980
               |01/09/2017	4794.859863
               |01/10/2017	4891.560059
               |01/11/2017	5017.470215
               |01/12/2017	5150.830078
               |01/01/2018	5232.720215
               |01/02/2018	5497.919922
               |01/03/2018	5311.620117
               |01/04/2018	5158.700195
               |01/05/2018	5184.419922""".stripMargin



  def main(args: Array[String]): Unit = {
    val d: Seq[(String, Double)] = data.split("\n").toVector.map { x =>
      val all = x.split("\t")
      (all(0), all(1).toDouble)
    }

    val yearPeriod = 10
    val nbMonths = yearPeriod * 12
    (0 until d.size - nbMonths).foreach { i =>
      val total = (i until i + nbMonths).foldLeft(0.0) { case (current, index) =>
          current + 1000 / d(index)._2
      }
      val lastValue = d(i + nbMonths - 1)._2 * total
      val cf = (0 until nbMonths) map {
        case idx if idx < nbMonths - 1 => CashFlow(-1000.0, idx / 12.0)
        case idx if idx == nbMonths - 1 => CashFlow(-1000.0 + lastValue, idx / 12.0)
        case _ => throw new RuntimeException("This is just impossible")
      }
      println(d(i)._1, InternalRateOfReturn.computeInternalRateOfReturn(cf.toList))

    }

  }

}
